{% extends 'dashboard/base.html' %}

{% block title %}Quarter: {{ quarter }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>Quarter: {{ quarter }}</h1>
        <div>
            <a href="{% url 'quarter-update' quarter.id %}" class="btn btn-warning">
                <i class="fas fa-edit"></i> Edit
            </a>
            <a href="{% url 'quarter-delete' quarter.id %}" class="btn btn-danger">
                <i class="fas fa-trash"></i> Delete
            </a>
            <a href="{% url 'quarter-list' %}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Back to List
            </a>
            {% if not quarter.completed %}
            <a href="{% url 'quarter-complete' quarter.id %}" class="btn btn-success">
                <i class="fas fa-check-circle"></i> Complete Quarter
            </a>
            {% else %}
            <a href="{% url 'quarter-summary' quarter.id %}" class="btn btn-info">
                <i class="fas fa-chart-bar"></i> View Summary
            </a>
            {% endif %}
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header">
                    <h5>Quarter Details</h5>
                </div>
                <div class="card-body">
                    <table class="table">
                        <tr>
                            <th>Quarter:</th>
                            <td>Q{{ quarter.quarter_number }}</td>
                        </tr>
                        <tr>
                            <th>Year:</th>
                            <td>{{ quarter.year }}</td>
                        </tr>
                        <tr>
                            <th>Name:</th>
                            <td>{{ quarter.name|default:"Not specified" }}</td>
                        </tr>
                        <tr>
                            <th>Start Date:</th>
                            <td>{{ quarter.start_date|date:"M d, Y" }}</td>
                        </tr>
                        <tr>
                            <th>End Date:</th>
                            <td>{{ quarter.end_date|date:"M d, Y" }}</td>
                        </tr>
                        <tr>
                            <th>Duration:</th>
                            <td>{{ quarter.end_date|timeuntil:quarter.start_date }}</td>
                        </tr>
                        <tr>
                            <th>Created:</th>
                            <td>{{ quarter.created_at|date:"M d, Y H:i" }}</td>
                        </tr>
                        <tr>
                            <th>Last Updated:</th>
                            <td>{{ quarter.updated_at|date:"M d, Y H:i" }}</td>
                        </tr>
                        <tr>
                            <th>Status:</th>
                            <td>
                                {% if quarter.completed %}
                                <span class="badge bg-success">Completed</span>
                                {% else %}
                                <span class="badge bg-warning">In Progress</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% if quarter.completed %}
                        <tr>
                            <th>Completion Date:</th>
                            <td>{{ quarter.completion_date|date:"M d, Y" }}</td>
                        </tr>
                        {% if quarter.completion_notes %}
                        <tr>
                            <th>Completion Notes:</th>
                            <td>{{ quarter.completion_notes }}</td>
                        </tr>
                        {% endif %}
                        {% endif %}
                    </table>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5>Quarter Targets</h5>
                    <a href="{% url 'quarter-target-create' quarter.id %}" class="btn btn-sm btn-success">
                        <i class="fas fa-plus"></i> Add Target
                    </a>
                </div>
                <div class="card-body">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Project</th>
                                <th>Target Description</th>
                                <th>Target Value</th>
                                <th>Resources</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for target in targets %}
                            <tr>
                                <td>{{ target.project.name }}</td>
                                <td>{{ target.target_description|truncatechars:50 }}</td>
                                <td>{{ target.target_value|default:"N/A" }}</td>
                                <td>{{ target.resources.count }}</td>
                                <td>
                                    <a href="{% url 'quarter-target-detail' target.id %}" class="btn btn-sm btn-info">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    <a href="{% url 'quarter-target-update' target.id %}" class="btn btn-sm btn-warning">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <a href="{% url 'quarter-target-delete' target.id %}" class="btn btn-sm btn-danger">
                                        <i class="fas fa-trash"></i>
                                    </a>
                                    <a href="{% url 'assign-resource-to-target' target.id %}" class="btn btn-sm btn-primary">
                                        <i class="fas fa-user-plus"></i>
                                    </a>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="5" class="text-center">No targets set for this quarter. Add a target to get started.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
