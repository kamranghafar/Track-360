{% extends 'dashboard/base.html' %}

{% block title %}{{ automation_sprint.product.name }} Sprint - {{ automation_sprint.start_date|date:"M d, Y" }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="card mb-4">
        <div class="card-body bg-light">
            <div class="d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center">
                    <div class="me-3">
                        <i class="fas fa-stopwatch fa-3x text-success"></i>
                    </div>
                    <div>
                        <h1 class="mb-0">{{ automation_sprint.product.name }} Sprint</h1>
                        <p class="text-muted mb-0">
                            <i class="fas fa-calendar-alt me-1"></i> Started: {{ automation_sprint.start_date|date:"F d, Y" }}
                            <span class="mx-2">|</span>
                            <i class="fas fa-clock me-1"></i> Length: {{ automation_sprint.get_sprint_length_display }}
                        </p>
                    </div>
                </div>
                <div>
                    <a href="{% url 'automation-sprint-list' %}" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left me-1"></i> Back to Sprints
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8">
            <div class="card mb-4">
                <div class="card-header bg-success text-black">
                    <h5><i class="fas fa-info-circle"></i> Sprint Details</h5>
                </div>
                <div class="card-body">
                    <!-- Sprint Overview Section -->
                    <div class="alert alert-light border mb-4">
                        <div class="d-flex align-items-center mb-2">
                            <i class="fas fa-project-diagram fa-2x me-2 text-success"></i>
                            <h5 class="mb-0">Sprint Overview</h5>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-2">
                                    <i class="fas fa-cube text-muted me-1"></i>
                                    <strong>Product:</strong> 
                                    <span class="ms-1">{{ automation_sprint.product.name }}</span>
                                </div>
                                <div class="mb-2">
                                    <i class="fas fa-user-tie text-muted me-1"></i>
                                    <strong>Engineering Manager:</strong> 
                                    <span class="ms-1">{{ automation_sprint.engineering_manager_name }}</span>
                                </div>
                                <div class="mb-2">
                                    <i class="fas fa-calendar-alt text-muted me-1"></i>
                                    <strong>Sprint Length:</strong> 
                                    <span class="ms-1">{{ automation_sprint.get_sprint_length_display }}</span>
                                </div>
                                <div class="mb-2">
                                    <i class="fas fa-users text-muted me-1"></i>
                                    <strong>Total Dev Resources:</strong> 
                                    <span class="ms-1">{{ automation_sprint.total_dev_resources }}</span>
                                </div>
                                <div class="mb-2">
                                    <i class="fas fa-tag text-muted me-1"></i>
                                    <strong>Sprint Type:</strong> 
                                    <span class="ms-1">{{ automation_sprint.get_sprint_type_display }}</span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-2">
                                    <i class="fas fa-calendar-day text-muted me-1"></i>
                                    <strong>Start Date:</strong> 
                                    <span class="ms-1">{{ automation_sprint.start_date|date:"F d, Y" }}</span>
                                </div>
                                <div class="mb-2">
                                    <i class="fas fa-tasks text-muted me-1"></i>
                                    <strong>Status:</strong> 
                                    <span class="badge {% if automation_sprint.status == 'in_progress' %}bg-primary{% elif automation_sprint.status == 'complete' %}bg-success{% elif automation_sprint.status == 'on_hold' %}bg-warning{% else %}bg-secondary{% endif %} ms-1">
                                        {{ automation_sprint.get_status_display }}
                                    </span>
                                </div>
                                <div class="mb-2">
                                    <i class="fas fa-user-check text-muted me-1"></i>
                                    <strong>QA Point of Contact:</strong> 
                                    <span class="ms-1">{{ automation_sprint.qa_point_of_contact.name|default:"Not assigned" }}</span>
                                </div>
                                <div class="mb-2">
                                    <i class="fas fa-graduation-cap text-muted me-1"></i>
                                    <strong>Dev Training Status:</strong> 
                                    <span class="badge {% if automation_sprint.dev_training_status == 'completed' %}bg-success{% elif automation_sprint.dev_training_status == 'in_progress' %}bg-primary{% else %}bg-secondary{% endif %} ms-1">
                                        {{ automation_sprint.get_dev_training_status_display }}
                                    </span>
                                </div>
                                <div class="mb-2">
                                    <i class="fas fa-clock text-muted me-1"></i>
                                    <strong>Created:</strong> 
                                    <span class="ms-1">{{ automation_sprint.created_at|date:"F d, Y H:i" }}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Rationale Section -->
                    <div class="mb-4">
                        <div class="d-flex align-items-center mb-2">
                            <i class="fas fa-bullseye fa-lg me-2 text-primary"></i>
                            <h6 class="mb-0">Rationale</h6>
                        </div>
                        <div class="border p-3 rounded bg-light">{{ automation_sprint.rationale|safe|linebreaks|default:"No rationale provided." }}</div>
                    </div>

                    <!-- Risks Section -->
                    <div class="mb-4">
                        <div class="d-flex align-items-center mb-2">
                            <i class="fas fa-exclamation-triangle fa-lg me-2 text-warning"></i>
                            <h6 class="mb-0">Risks</h6>
                        </div>
                        <div class="border p-3 rounded bg-light">{{ automation_sprint.risks|safe|linebreaks|default:"No risks identified." }}</div>
                    </div>

                    <!-- Notes Section -->
                    <div>
                        <div class="d-flex align-items-center mb-2">
                            <i class="fas fa-sticky-note fa-lg me-2 text-info"></i>
                            <h6 class="mb-0">Notes</h6>
                        </div>
                        <div class="border p-3 rounded bg-light">{{ automation_sprint.notes|safe|linebreaks|default:"No notes provided." }}</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card mb-4">
                <div class="card-header bg-primary text-black">
                    <h5><i class="fas fa-chart-line"></i> Sprint Metrics</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-1">
                            <span><strong>Total Sprint Days:</strong></span>
                            <span class="badge bg-info">{{ automation_sprint.total_sprint_days }}</span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-1">
                            <span><strong>Total Planned Working Hours:</strong></span>
                            <span class="badge bg-info">{{ automation_sprint.total_planned_working_hours }}</span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <span><strong>Blocked Hours:</strong></span>
                            <span class="badge bg-warning">{{ automation_sprint.blocked_hours }}</span>
                        </div>
                    </div>

                    <hr>

                    <div class="mb-3">
                        <h6 class="text-muted">Test Case Automation</h6>
                        <div class="d-flex justify-content-between align-items-center mb-1">
                            <span><strong>Total Planned Test Cases:</strong></span>
                            <span class="badge bg-secondary">{{ automation_sprint.total_planned_test_cases }}</span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span><strong>Total Test Cases Automated:</strong></span>
                            <span class="badge bg-success">{{ automation_sprint.total_test_cases_automated }}</span>
                        </div>

                        {% if automation_sprint.total_planned_test_cases > 0 %}
                        <div class="alert alert-success">
                            <div class="d-flex align-items-center">
                                <div class="me-2">
                                    <i class="fas fa-check-circle fa-2x"></i>
                                </div>
                                <div>
                                    <strong>Automation Progress:</strong>
                                    <p class="mb-0">{{ automation_sprint.total_test_cases_automated }} of {{ automation_sprint.total_planned_test_cases }} test cases automated</p>
                                </div>
                            </div>
                        </div>
                        {% else %}
                        <div class="alert alert-info">
                            <div class="d-flex align-items-center">
                                <div class="me-2">
                                    <i class="fas fa-info-circle fa-2x"></i>
                                </div>
                                <div>
                                    <strong>No Metrics Available</strong>
                                    <p class="mb-0">Add metrics to track test case automation progress.</p>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header bg-dark text-white">
                    <h5><i class="fas fa-cogs"></i> Actions</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="{% url 'automation-sprint-metrics' automation_sprint.id %}" class="btn btn-primary mb-2">
                            <div class="d-flex align-items-center justify-content-center">
                                <i class="fas fa-chart-line me-2"></i>
                                <span>Add/Update Sprint Metrics</span>
                            </div>
                        </a>
                        <a href="{% url 'automation-sprint-update' automation_sprint.id %}" class="btn btn-warning mb-2">
                            <div class="d-flex align-items-center justify-content-center">
                                <i class="fas fa-edit me-2"></i>
                                <span>Edit Sprint</span>
                            </div>
                        </a>
                        <a href="{% url 'automation-sprint-delete' automation_sprint.id %}" class="btn btn-danger">
                            <div class="d-flex align-items-center justify-content-center">
                                <i class="fas fa-trash me-2"></i>
                                <span>Delete Sprint</span>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
