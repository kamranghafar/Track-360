{% extends 'dashboard/base.html' %}

{% block title %}Import Products{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>Import Products</h1>
        <div>
            <a href="{% url 'product-list' %}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Back to Products
            </a>
            <a href="{% url 'product-sample-file' %}?format=csv" class="btn btn-info">
                <i class="fas fa-download"></i> Download CSV Sample
            </a>
            <a href="{% url 'product-sample-file' %}?format=excel" class="btn btn-info">
                <i class="fas fa-download"></i> Download Excel Sample
            </a>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h5>Upload Product File</h5>
        </div>
        <div class="card-body">
            {% if messages %}
            <div class="messages">
                {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">
                    {{ message }}
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="mb-3">
                    <label for="file" class="form-label">Select CSV or Excel File</label>
                    <input type="file" class="form-control" id="file" name="file" accept=".csv, .xls, .xlsx" required>
                    <div class="form-text">
                        The file should contain the following required column: <strong>name</strong><br>
                        Optional columns include basic fields (description, start_date, end_date, status) and automation-related fields.<br>
                        Download a sample file to see all available fields.
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-upload"></i> Import Products
                </button>
            </form>
        </div>
    </div>

    <div class="card mt-4">
        <div class="card-header">
            <h5>Import Instructions</h5>
        </div>
        <div class="card-body">
            <h6>File Format</h6>
            <p>The import file should be in CSV or Excel format with the following columns:</p>

            <h6>Basic Fields</h6>
            <ul>
                <li><strong>name</strong> (required): The name of the product</li>
                <li><strong>description</strong>: The description of the product</li>
                <li><strong>start_date</strong>: The start date of the product (YYYY-MM-DD format)</li>
                <li><strong>end_date</strong>: The end date of the product (YYYY-MM-DD format, can be empty)</li>
                <li><strong>status</strong>: The status of the product (not_started, in_progress, completed, on_hold)</li>
            </ul>

            <h6>Automation-Related Fields</h6>
            <ul>
                <li><strong>smoke_automation_status</strong>: Status of smoke automation (hold, completed, in_progress, na)</li>
                <li><strong>regression_automation_status</strong>: Status of regression automation (hold, completed, in_progress, na)</li>
                <li><strong>pipeline_schedule</strong>: Schedule for automation pipeline (on_demand, weekly, nightly, na)</li>
                <li><strong>execution_time_of_smoke</strong>: Time taken to execute smoke tests (e.g., "1h 30m")</li>
                <li><strong>total_number_of_available_test_cases</strong>: Total number of available test cases</li>
                <li><strong>status_of_last_automation_run</strong>: Status of the last automation run</li>
                <li><strong>date_of_last_automation_run</strong>: Date of the last automation run (YYYY-MM-DD format)</li>
                <li><strong>automation_framework_tech_stack</strong>: Description of the automation framework and tech stack</li>
                <li><strong>team_lead_id</strong>: ID of the team lead resource</li>
                <li><strong>regression_coverage</strong>: Percentage or count of regression coverage</li>
                <li><strong>bugs_found_through_automation</strong>: Number of bugs found through automation</li>
                <li><strong>total_automatable_test_cases</strong>: Total number of test cases that can be automated</li>
                <li><strong>total_automatable_smoke_test_cases</strong>: Total number of smoke test cases that can be automated</li>
                <li><strong>total_automated_test_cases</strong>: Total number of test cases that are automated</li>
                <li><strong>total_automated_smoke_test_cases</strong>: Total number of smoke test cases that are automated</li>
                <li><strong>sprint_cycle</strong>: Description of the sprint cycle</li>
                <li><strong>total_number_of_functional_test_cases</strong>: Total number of functional test cases</li>
                <li><strong>total_number_of_business_test_cases</strong>: Total number of business test cases</li>
                <li><strong>oat_release_cycle</strong>: Description of the OAT release cycle</li>
                <li><strong>readiness_for_production</strong>: Whether the product is ready for production (true/false, yes/no, 1/0)</li>
            </ul>

            <h6>Notes</h6>
            <ul>
                <li>If a product with the same name already exists, it will be updated with the new information.</li>
                <li>If a column is missing or empty, the corresponding field will be left blank or set to its default value.</li>
                <li>The status field must be one of: not_started, in_progress, completed, on_hold.</li>
                <li>The automation status fields must be one of: hold, completed, in_progress, na.</li>
                <li>The pipeline schedule field must be one of: on_demand, weekly, nightly, na.</li>
                <li>Dates should be in YYYY-MM-DD format (e.g., 2023-01-31).</li>
                <li>Boolean fields (like readiness_for_production) accept: true/false, yes/no, 1/0.</li>
                <li>For a complete example with all fields, download the sample file.</li>
            </ul>
        </div>
    </div>
</div>
{% endblock %}
